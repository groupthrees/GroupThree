@using Brewmaster.Alcohol.Client.Models.Dto
@model List<ShopCartDto>
@{
    Layout = null;
}

<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>我的购物车</title>

    <link rel="stylesheet" href="~/Wine/jQuery仿淘宝商城购物车结算界面代码/css/reset.css" />
    <link rel="stylesheet" href="~/Wine/jQuery仿淘宝商城购物车结算界面代码/css/carts.css" />

</head>
<body>
    <section class="cartMain">
        <div class="cartMain_hd">
            <ul class="order_lists cartTop">
                <li class="list_chk">
                    <!--所有商品全选-->
                    <input type="checkbox" id="all" class="whole_check" />
                    <label for="all"></label>
                    全选
                </li>
                <li class="list_con">商品信息</li>
                <li class="list_info">商品参数</li>
                <li class="list_price">单价</li>
                <li class="list_amount">数量</li>
                <li class="list_sum">金额</li>
                <li class="list_op">操作</li>
            </ul>
        </div>

        <div class="cartBox">
            <div class="shop_info">
                <div class="all_check">
                    <!--店铺全选-->
                    <input type="checkbox" id="shop_a" class="shopChoice" />
                    <label for="shop_a" class="shop"></label>
                </div>
                <div class="shop_name">
                    店铺：<a href="javascript:;">搜猎人艺术生活</a>
                </div>
            </div>
            <div class="order_content">
                @{

                    int i = 0;

                }
                @foreach (var item in Model)
                {
                    i++;
                    <ul class="order_lists">
                        <li class="list_chk">
                            <input type="checkbox" name="checkboxid" value="@item.Id" id="checkbox_@i" class="son_check" />
                            <label for="checkbox_@i"></label>
                        </li>
                        <li class="list_con">
                            <div class="list_img"><a href="javascript:;"><img src="@item.GoodsImg" alt="" onclick="fun('@item.GoodsId')" /></a></div>
                            <div class="list_text"><a href="javascript:;" onclick="fun(' @item.Id ')">@item.GoodsName</a></div>
                        </li>
                        <li class="list_info">
                            <p>规格：默认</p>
                            <p>尺寸：16*16*3(cm)</p>
                        </li>
                        <li class="list_price">
                            <p class="price" name="@item.PriceNow">￥@item.PriceNow</p>
                        </li>
                        <li class="list_amount">
                            <div class="amount_box">
                                <a href="javascript:;" class="reduce reSty">-</a>
                                <input type="text" value="@item.Num" class="sum" />
                                <a href="javascript:;" class="plus">+</a>
                            </div>


                        </li>
                        <li class="list_sum">
                            <p class="sum_price" name="@(item.PriceNow * item.Num)">￥@(item.PriceNow * item.Num)</p>
                        </li>
                        <li class="list_op">
                            <p class="del"> <input id="Button1" type="button" value="移除商品" onclick="deletegoods('@item.Id')" /></p>
                        </li>
                    </ul>
                }


                <!--底部-->
                <div class="bar-wrapper">
                    <div style="float:left;">
                        <input id="Button1" type="button" value="移除商品" style="padding: 20px 20px;font-size:16px" onclick="batchdeletegoods()" />
                    </div>
                    <div class="bar-right">
                        <div class="piece">已选商品<strong class="piece_num">0</strong>件</div>
                        <div class="totalMoney">共计: <strong class="total_text">0.00</strong></div>
                        <div class="calBtn"><a href="javascript:;">结算</a></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="model_bg"></section>
    <section class="my_model">
        <p class="title">删除宝贝<span class="closeModel">X</span></p>
        <p>您确认要删除该宝贝吗？</p>
        <div class="opBtn"><a href="javascript:;" class="dialog-sure">确定</a><a href="javascript:;" class="dialog-close">关闭</a></div>
    </section>

    <script src="~/Wine/jQuery仿淘宝商城购物车结算界面代码/js/jquery.min.js"></script>
    <script src="~/Wine/jQuery仿淘宝商城购物车结算界面代码/js/carts.js"></script>

    <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';">

    </div><input id="Button1" type="button" value="去结算" />
    <input id="Button1" type="button" value="button" onclick="redis()" />
</body>
</html>
<script>
    sum = 0;
    function fun(id) {
        var usersId = $('#Hidden1').val();
        location.href = '/ShopDetails/Index2?goodsId=' + id + '&usersId=' + usersId + '';
    }

    function batchdeletegoods() {
        text = $("input:checkbox[name='checkboxid']:checked").map(function (index, elem) {
            return $(elem).val();
        }).get().join(',');


        var msg = "确定要删除吗？"
        if (confirm(msg) == true) {
            //异步访问批量删除方法， 把数组传入controller层
            $.ajax({
                type: "delete",
                url: "http://localhost:50169/api/ShopCart/DeleteShopCart?id=" + text,
                success: function (data) {
                    if (data > 0) {
                        alert("删除成功!");
                        location.reload();
                    }
                    else {
                        alert("删除失败!");
                    }
                }

            });
        }
    }


    function deletegoods(id) {
        var msg = "确定要删除吗？"
        if (confirm(msg) == true) {
            //异步访问批量删除方法， 把数组传入controller层
            $.ajax({
                type: "delete",
                url: "http://localhost:50169/api/ShopCart/DeleteShopCart?id=" + id,
                data: { id: id },
                success: function (data) {
                    if (data > 0) {
                        alert("删除成功!");
                        location.reload();
                    }
                    else {
                        alert("删除失败!");
                    }
                }

            });
        }

    }

    function redis() {
        sun = 0;
        var num = "";
        var price = "";
        var onlyGoods = "";//商品单价
        text = $("input:checkbox[name='checkboxid']:checked").map(function (index, elem) {


            danjia = $(elem).parent().siblings().next().next().first()[0].innerText;
            jiaGe = $(elem).parent().siblings().next().next().next().next().first()[0].innerText

            jiaGe = "," + jiaGe;
            p = jiaGe.substr(2, jiaGe.length - 2);//小计

            danjia = "," + danjia;
            d = danjia.substr(2, danjia.length - 2);//单价

            num += "," + parseInt(p) / parseInt(d);
            console.log("单价：" + d + "数量：" + num + "小计：" + p + "商品id：" + $(elem).val());

            sum += parseInt(p);


            price += "," + p;
            onlyGoods += "," + d;
            return $(elem).val();
        }).get().join(',');

        price=price.substr(1, price.length-1)
        onlyGoods=onlyGoods.substr(1, onlyGoods.length - 1)
        num=num.substr(1, num.length - 1)
        //text=text.substr(1, num.length - 1)
        console.log(text);
        console.log(onlyGoods);
        console.log(num);
        console.log(price);
        console.log(sum);


    }



</script>
