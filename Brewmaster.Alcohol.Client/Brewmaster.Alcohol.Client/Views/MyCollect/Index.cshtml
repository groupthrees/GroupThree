
@{
    Layout = null;
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script type="text/javascript" async="" charset="utf-8" src="~/Wine/我的酒仙网 ) 我的收藏_files/pushData.txt"></script>
    <script type="text/javascript" async="" src="~/Wine/我的酒仙网 ) 我的收藏_files/mv.js"></script>
    <script type="text/javascript" async="" src="~/Wine/我的酒仙网 ) 我的收藏_files/mba.js"></script>
    <script type="text/javascript" async="" src="~/Wine/我的酒仙网 ) 我的收藏_files/visittrack.js"></script>
    <script type="text/javascript" async="" src="~/Wine/我的酒仙网 ) 我的收藏_files/mvl.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name="save" content="history" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Cache-Control" content="no-cache,must-revalidate" />
    <script type="text/javascript">
        var mobileRegex_o = "^1[3-9][0-9]{9}$";// 对象 new RegExp
        var mobileRegex_s = /^1[3-9][0-9]{9}$/;// 字符串
        var mobileRegex_s_star = /^1[3-9][0-9]{9}$|^([0-9]{3}\*{4}[0-9]{4})$/;
        var mobileRegex_o_star = "^1[3-9][0-9]{9}$|^([0-9]{3}\\*{4}[0-9]{4})$";
    </script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/usercenter-web-pc.js" type="text/javascript"></script>
    <title>我的酒仙网 &gt; 我的收藏</title>
    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/base.css" type="text/css" rel="stylesheet" />
    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/header.css" rel="stylesheet" type="text/css" />
    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/footer.css" rel="stylesheet" type="text/css" />

    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/user.css" rel="stylesheet" type="text/css" />
    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/user_nav.css" rel="stylesheet" type="text/css" />

    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/jquery_002.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/jquery.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/base.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/region.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/public.js" type="text/javascript"></script>

    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/userCenterCtrlWidth.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/Slider.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/position.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/turn_bottom.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/easing.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/usercenter.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/sidenav.js" type="text/javascript"></script>
    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/alert.js" type="text/javascript"></script>

    <script type="text/javascript" src="~/Wine/我的酒仙网 ) 我的收藏_files/collect.js"></script>

    <link href="~/Wine/我的酒仙网 ) 我的收藏_files/user_1200.css" id="newLink" rel="stylesheet" type="text/css" />
    <!-- <script src="http://misc.jiuxian.com/js/usercenter/Verification.js" type="text/javascript"></script> -->

</head>
<body>




    <script src="~/Wine/我的酒仙网 ) 我的收藏_files/skipmobileweb.js"></script>
    <script type="text/javascript">isMobile();</script>

    <!-- 右侧 -->
    <div>
        <div class="rightTit"><h2><i></i>我的收藏</h2></div>
        <div class="rightCon">
            <ul class="mycolNav clearfix">
                <li id="all" onclick="javascript:document.getElementById('whole').click();" class="mctOn">全部<a id="whole" href="#"></a></li>
                <li id="baijiu" onclick="javascript:document.getElementById(1).click();">
                    <a id="1" href="#" display:none=""></a>
                </li>

            </ul>
            <table class="mycolBox" cellspacing="0" cellpadding="0" border="0">

                <thead>
                    <tr>
                        <th class="mycT0" width="130"><input name='smallBox' id="selectAll" type="checkbox" onclick="setchecked(this.checked)" />全选  </th>
                        <th class="mycT2" width="330"><span>图片</span></th>
                        <th class="mycT2" width="330"><span>商品</span></th>
                        <th class="mycT4" width="225">当前价格</th>
                        <th class="mycT5" width="165">操作</th>
                    </tr>
                </thead>
                <tbody id="await"></tbody>

            </table>
            <a href="javascript:void(0)" onclick="first()">首页</a>
            <a href="javascript:void(0)" onclick="prve()">上一页</a>
            <a href="javascript:void(0)" onclick="next()">下一页</a>
            <a href="javascript:void(0)" onclick="last()">尾页</a>
            <input type="hidden" id="currRecordSize" value="2" />
        </div>

    </div>
    <!-- 右侧 -->



    <style type="text/css">
        .footerBotLeft .footerInfo {
            margin-left: -8px;
        }

        .footerBotLeft p {
            font-family: Arial, Helvetica, sans-serif, "宋体";
        }

        .footerBotLeft .footerInfo a {
            color: #666;
        }

        .footerBotLeft .copyright {
            color: #666;
        }
    </style>



    <script type="text/javascript" src="~/Wine/我的酒仙网 ) 我的收藏_files/recommend_99.js"></script>
    <script type="text/javascript" src="~/Wine/我的酒仙网 ) 我的收藏_files/p_code.js"></script>
    <script type="text/javascript" src="~/Wine/我的酒仙网 ) 我的收藏_files/FAI84qYjQk.txt"></script>
    <script type="text/javascript" src="~/Wine/我的酒仙网 ) 我的收藏_files/o_code.js"></script>

</body>
</html>


<script>

    var pageIndex = 1;
    var pageSize = 3;
    var total = 0;

    $(function () {

        getCoupon(pageIndex);
       

    })

    //全选 反选
    function setchecked(checked) {
        $("input[type=checkbox]").attr("checked", checked)
    }


    function getCoupon(index) {
        $.ajax({
            type: "get",
            url: 'http://localhost:50169/api/Collection/GetCollectionlist',
            data: { id: @ViewBag.id , pageIndex: index, pageSize: pageSize },
            success: function (result) {

                console.log(result);
                var tmphtml = "";
                $("#await").empty();

                for (var i = 0; i < result.collectionList.length; i++) {
                    tmphtml += "<tr>";

                    tmphtml += "<td><input type='checkbox' name='smallBox' value='' /></td>";
                    tmphtml += "<td><img src=" + result.collectionList[i].goodsImg + "  width='50' height='50' onclick='fun(" + result.collectionList[i].id + ")'></td>";
                    tmphtml += "<td> <a  href = '#' onclick ='fun(" + result.collectionList[i].id + ")'>" + result.collectionList[i].goodsName + "</a></td>";
                    tmphtml += "<td>" + result.collectionList[i].priceNow + "</td>";
                    tmphtml += "<td><input type='button' value='加入购物车' onclick='joinshopCar(" + result.collectionList[i].goodsId + ")'/><input type='button' value='取消收藏' onclick='cancelcollect(" + result.collectionList[i].goodsId + ")'/></td>";
                    tmphtml += "</tr>";
                }
                $("#await").append(tmphtml);
                total = result.total;
            }
        })
    }

    //加入购物车
    function joinshopCar(goodsId) {
        var date = {
            "id": 0,
            "goodsId": goodsId,
            "usersId": 1,
            "num": 1
        };
        var val = JSON.stringify(date);
        $.ajax({
            url: 'http://localhost:50169/api/Collection/InsertShopCart',
            data: val,
            type: "post",
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: 'json',
            success: function (data) {
                if (data > 0) {
                    alert("添加购物车成功");
                }
                else {
                    alert("添加购物车失败");
                }
            }
        })
    }

    //取消收藏
    function cancelcollect(goodsId) {
        $.ajax({
            type: "get",
            url: 'http://localhost:50169/api/Goodscollect/SetCollect',
            data: { userId: 1, goodsId: goodsId },
            success: function (result) {
                if (result == 2) {
                    location.href = "/MyCollect/index";
                }
                else {
                    alert("错了")
                }
            }
        })
    }

    //商品详情页
    function fun(id) {
        var usersId = $('#Hidden1').val();
        location.href = '/ShopDetails/Index2?goodsId=' + id + '&usersId=' + usersId + '';
    }

    //查询
    function search() {
        getCoupon(pageIndex);
    }

    //首页
    function first() {
        pageIndex = 1;

        getCoupon(pageIndex);
    }

    //上页
    function prve() {
        pageIndex = pageIndex > 1 ? pageIndex - 1 : 1;
        getCoupon(pageIndex);
    }

    //下页
    function next() {
        var nums = Math.ceil(total / pageSize);
        pageIndex = pageIndex < nums ? pageIndex + 1 : pageIndex;
        getCoupon(pageIndex);
    }

    //尾页
    function last() {
        pageIndex = Math.ceil(total / pageSize);
        getCoupon(pageIndex);
    }

</script>
